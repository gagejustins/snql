/*!
 * Application Insights JavaScript SDK - Core, 2.1.1
 * Copyright (c) Microsoft and contributors. All rights reserved.
 */
!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((e.Microsoft=e.Microsoft||{},e.Microsoft.ApplicationInsights={}))}(this,function(a){"use strict";var i={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5},l=(e.isNullOrUndefined=function(e){return null==e},e.disableCookies=function(){e._canUseCookies=!1},e.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(n,function(e){var i=16*Math.random()|0;return("x"===e?i:3&i|8).toString(16)})},e);function e(){}var t,n=/[xy]/g,c=(o.prototype.addNotificationListener=function(e){this.listeners.push(e)},o.prototype.removeNotificationListener=function(e){for(var i=this.listeners.indexOf(e);-1<i;)this.listeners.splice(i,1),i=this.listeners.indexOf(e)},o.prototype.eventsSent=function(i){for(var t=this,e=function(e){n.listeners[e].eventsSent&&setTimeout(function(){return t.listeners[e].eventsSent(i)},0)},n=this,o=0;o<this.listeners.length;++o)e(o)},o.prototype.eventsDiscarded=function(i,t){for(var n=this,e=function(e){o.listeners[e].eventsDiscarded&&setTimeout(function(){return n.listeners[e].eventsDiscarded(i,t)},0)},o=this,r=0;r<this.listeners.length;++r)e(r)},o);function o(){this.listeners=[]}(t=a.LoggingSeverity||(a.LoggingSeverity={}))[t.CRITICAL=1]="CRITICAL",t[t.WARNING=2]="WARNING";var s={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70},g=(r.sanitizeDiagnosticText=function(e){return'"'+e.replace(/\"/g,"")+'"'},r.dataType="MessageData",r.AiNonUserActionablePrefix="AI (Internal): ",r.AiUserActionablePrefix="AI: ",r);function r(e,i,t,n){void 0===t&&(t=!1),this.messageId=e,this.message=(t?r.AiUserActionablePrefix:r.AiNonUserActionablePrefix)+e;var o=(i?" message:"+r.sanitizeDiagnosticText(i):"")+(n?" props:"+r.sanitizeDiagnosticText(JSON.stringify(n)):"");this.message+=o}var f=(u.prototype.throwInternal=function(e,i,t,n,o){void 0===o&&(o=!1);var r=new g(i,t,o,n);if(this.enableDebugExceptions())throw r;if(void 0!==r&&r&&void 0!==r.message){if(o){var s=+r.messageId;(!this._messageLogged[s]||this.consoleLoggingLevel()>=a.LoggingSeverity.WARNING)&&(this.warnToConsole(r.message),this._messageLogged[s]=!0)}else this.consoleLoggingLevel()>=a.LoggingSeverity.WARNING&&this.warnToConsole(r.message);this.logInternalMessage(e,r)}},u.prototype.warnToConsole=function(e){"undefined"!=typeof console&&console&&("function"==typeof console.warn?console.warn(e):"function"==typeof console.log&&console.log(e))},u.prototype.resetInternalMessageCount=function(){this._messageCount=0,this._messageLogged={}},u.prototype.logInternalMessage=function(e,i){if(!this._areInternalMessagesThrottled()){var t=!0,n=this.AIInternalMessagePrefix+i.messageId;if(this._messageLogged[n]?t=!1:this._messageLogged[n]=!0,t&&(e<=this.telemetryLoggingLevel()&&(this.queue.push(i),this._messageCount++),this._messageCount==this.maxInternalMessageLimit())){var o="Internal events throttle limit per PageView reached for this app.",r=new g(s.MessageLimitPerPVExceeded,o,!1);this.queue.push(r),this.warnToConsole(o)}}},u.prototype._areInternalMessagesThrottled=function(){return this._messageCount>=this.maxInternalMessageLimit()},u);function u(e){this.AIInternalMessagePrefix="AITR_",this.enableDebugExceptions=function(){return!1},this.consoleLoggingLevel=function(){return 1},this.telemetryLoggingLevel=function(){return 0},this.maxInternalMessageLimit=function(){return 25},this.queue=[],this._messageCount=0,this._messageLogged={},l.isNullOrUndefined(e)||(l.isNullOrUndefined(e.loggingLevelConsole)||(this.consoleLoggingLevel=function(){return e.loggingLevelConsole}),l.isNullOrUndefined(e.loggingLevelTelemetry)||(this.telemetryLoggingLevel=function(){return e.loggingLevelTelemetry}),l.isNullOrUndefined(e.maxMessageLimit)||(this.maxInternalMessageLimit=function(){return e.maxMessageLimit}),l.isNullOrUndefined(e.enableDebugExceptions)||(this.enableDebugExceptions=function(){return e.enableDebugExceptions}))}var h=(d.prototype.processTelemetry=function(i){this.channelQueue.forEach(function(e){0<e.length&&e[0].processTelemetry(i)})},Object.defineProperty(d.prototype,"ChannelControls",{get:function(){return this.channelQueue},enumerable:!0,configurable:!0}),d.prototype.initialize=function(t,n,o){var r=this;if(t.isCookieUseDisabled&&l.disableCookies(),this.channelQueue=new Array,t.channels){var s=void 0;t.channels.forEach(function(e){if(e&&0<e.length){if((e=e.sort(function(e,i){return e.priority-i.priority})).forEach(function(e){e.priority<500&&(s=e.identifier),e.initialize(t,n,o)}),s)throw Error("Channel has invalid priority"+s);for(var i=1;i<e.length;i++)e[i-1].setNextPlugin(e[i]);r.channelQueue.push(e)}})}for(var e=new Array,i=0;i<o.length;i++){var a=o[i];500<a.priority&&e.push(a)}if(0<e.length){for((e=e.sort(function(e,i){return e.priority-i.priority})).forEach(function(e){return e.initialize(t,n,o)}),i=1;i<e.length;i++)e[i-1].setNextPlugin(e[i]);this.channelQueue.push(e)}},d);function d(){this.identifier="ChannelControllerPlugin",this.priority=500}var p=(m.prototype.initialize=function(e,i){var t=this;if(this._isInitialized)throw Error("Core should not be initialized more than once");if(!e||l.isNullOrUndefined(e.instrumentationKey))throw Error("Please provide instrumentation key");this.config=e,this._notificationManager=new c,this.config.extensions=l.isNullOrUndefined(this.config.extensions)?[]:this.config.extensions,this.config.extensionConfig=l.isNullOrUndefined(this.config.extensionConfig)?{}:this.config.extensionConfig,this.config.extensionConfig.NotificationManager=this._notificationManager,this.logger=new f(e),(o=this._extensions).push.apply(o,i.concat(this.config.extensions)),this._extensions.forEach(function(e){var i=!0;if((l.isNullOrUndefined(e)||l.isNullOrUndefined(e.initialize))&&(i=!1),!i)throw Error("Extensions must provide callback to initialize")}),this._extensions.push(this._channelController),this._extensions=this._extensions.sort(function(e,i){var t=e,n=i,o=typeof t.processTelemetry,r=typeof n.processTelemetry;return"function"==o&&"function"==r?t.priority-n.priority:"function"==o&&"function"!=r?1:"function"!=o&&"function"==r?-1:void 0});var n={};this._extensions.forEach(function(e){var i=e;i&&i.priority&&(l.isNullOrUndefined(n[i.priority])?n[i.priority]=i.identifier:t.logger.warnToConsole("Two extensions have same priority"+n[i.priority]+", "+i.identifier))});for(var o,r=-1,s=0;s<this._extensions.length-1;s++){var a=this._extensions[s];if(!a||"function"==typeof a.processTelemetry){if(a.priority===this._channelController.priority){r=s+1;break}this._extensions[s].setNextPlugin(this._extensions[s+1])}}if(this._channelController.initialize(this.config,this,this._extensions),this._extensions.forEach(function(e){e&&e.priority<t._channelController.priority&&e.initialize(t.config,t,t._extensions)}),r<this._extensions.length&&this._extensions.splice(r),0===this.getTransmissionControls().length)throw new Error("No channels available");this._isInitialized=!0},m.prototype.getTransmissionControls=function(){return this._channelController.ChannelControls},m.prototype.track=function(e){if(null===e)throw this._notifyInvalidEvent(e),Error("Invalid telemetry item");e.iKey||(e.iKey=this.config.instrumentationKey),e.time||(e.time=(new Date).toISOString()),l.isNullOrUndefined(e.ver)&&(e.ver="4.0"),this._validateTelmetryItem(e),0==this._extensions.length&&this._channelController.processTelemetry(e);for(var i=0;i<this._extensions.length;){if(this._extensions[i].processTelemetry){this._extensions[i].processTelemetry(e);break}i++}},m.prototype.addNotificationListener=function(e){this._notificationManager.addNotificationListener(e)},m.prototype.removeNotificationListener=function(e){this._notificationManager.removeNotificationListener(e)},m.prototype.pollInternalLogs=function(){var t=this,e=this.config.diagnosticLogInterval;return 0<e||(e=1e4),setInterval(function(){var e=t.logger.queue;e.forEach(function(e){var i={name:"InternalMessageId: "+e.messageId,iKey:t.config.instrumentationKey,time:(new Date).toISOString(),baseType:g.dataType,baseData:{message:e.message}};t.track(i)}),e.length=0},e)},m.prototype._validateTelmetryItem=function(e){if(l.isNullOrUndefined(e.name))throw this._notifyInvalidEvent(e),Error("telemetry name required");if(l.isNullOrUndefined(e.time))throw this._notifyInvalidEvent(e),Error("telemetry timestamp required");if(l.isNullOrUndefined(e.iKey))throw this._notifyInvalidEvent(e),Error("telemetry instrumentationKey required")},m.prototype._notifyInvalidEvent=function(e){this._notificationManager.eventsDiscarded([e],i.InvalidEvent)},m);function m(){this._isInitialized=!1,this._extensions=new Array,this._channelController=new h}a.MinChannelPriorty=100,a.EventsDiscardedReason=i,a.AppInsightsCore=p,a.CoreUtils=l,a.NotificationManager=c,a.DiagnosticLogger=f,a._InternalLogMessage=g,a._InternalMessageId=s,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=applicationinsights-core-js.min.js.map
